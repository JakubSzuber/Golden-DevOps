---

# TODO Temporary workflow for testing purposes (delete later)

name: Features

on:
  workflow_dispatch:
    inputs:
      somechoice:
        description: 'Some choice'
        required: true
        default: 'one'
        type: choice
        options:
          - one
          - two
          - three
      print_tags:
        description: 'True to print to STDOUT'
        required: true
        type: boolean
      tags:
        description: 'Test scenario tags'
        required: true
        type: string
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true

# jobs:
#   print-tag:
#     runs-on: ubuntu-latest
#     if:  ${{ inputs.print_tags }} 
#     steps:
#       - name: Print the input tag to STDOUT
#         run: echo  The tags are ${{ inputs.tags }} and some choice is ${{ inputs.somechoice }}

jobs:
  datree-k8s-policy-check:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: helm-charts/main-chart
    # env:
    #   DATREE_TOKEN: ${{ secrets.DATREE_TOKEN }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run Datree Policy Check
        uses: datreeio/action-datree@main
        with:
          path: '.'
          cliArguments: ''
          isHelmChart: true
          helmArguments: '--values values.yaml -f helm-charts/main-chart/values-prod.yaml'

      - name: Upload analysis results to GitHub
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: datree.sarif
          wait-for-processing: true
